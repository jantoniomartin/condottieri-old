{% extends "machiavelli/base.html" %}


{% load i18n %}
{% load game_icons %}
{% load avatar_tags %}

{% block head_title %}
{% if player %}
	{% if player.done %}
		[&bull;]
	{% else %}
		[ ]
	{% endif %}
{% endif %}
 {{ game.slug }}
{% endblock %}

{% block body %}
<div id="game_info">
<ul>
<li>{% trans "Game" %}: {{ game.slug }}</li>
<li>{% trans "Year" %}: {{ game.year|default_if_none:"" }}</li>
<li>{% trans "Season" %}: {{ game.get_season_display|default_if_none:"" }}</li>
<li>{% trans "Phase" %}: {{ game.get_phase_display }}</li>
<li>{% trans "Time left" %}: 
{% if player and game.slots == 0 %}
	{% if time_exceeded %}
	<span style="color: LightCoral">
	{{ game.next_phase_change|timeuntil }} 
	</span>
	{% else %}
	<span style="color: Green">
	{{ player.next_phase_change|timeuntil }}
	</span>
	{% endif %}
{% else %}
	{{ game.next_phase_change|timeuntil }}</li>
{% endif %}
</li>
{% if player %}
<li>{% trans "Power" %}:
	{% if player.country %}
		{{ player.country }}
	{% endif %}
</li>
{% else %}
<li>
		{% ifnotequal game.slots 0 %}
			<a href="{% url machiavelli.views.join_game game.pk %}">{% trans "Join game" %}</a>
		{% endifnotequal %}
</li>
{% endif %}
{% if rules %}
<li>
{% trans "Rules" %}: {% rule_icons game.configuration %}
</li>
{% endif %}

{% if ducats %}
<li>{% trans "Ducats" %}: {{ ducats }}</li>
{% endif %}
</ul>
</div>



<div class="col1">
<div id="powers">
{% if player.country %}
<div style="text-align: center">
<img src="{{ STATIC_URL }}machiavelli/img/banner-{{ player.country.css_class }}.png" />
</div>
{% endif %}
{% if game.slots == 0 %} {# show all the powers info #}
{% for p in player_list %}
	{% if p.user %}
	<div class="player {{ p.country.css_class }}">
	<div><strong>{{ p.country }}</strong>
	{% if p.conqueror %}
		({{ p.conqueror.country }})
	{% endif %}
	{% if p.excommunicated %}
	<img src="{{ STATIC_URL }}machiavelli/img/excommunication-icon-16.png" />
	{% endif %}
	</div>
	{% if show_users %}
	<div><a href="{% url profile_detail username=p.user.username %}">{% avatar p.user 20 %}{{ p.user.username }}</a></div>
	{% endif %}
	<div>{% trans "Cities:" %} {{ p.number_of_cities }}</div>
	<div>{% trans "Units:" %} {{ p.number_of_units }}</div>
{% if player %}
	{% ifnotequal game.phase 0 %}
	{% ifnotequal p player %}
	{% ifnotequal p.eliminated 1 %}
	<div>
	<a href="{% url condottieri_messages_compose sender_id=player.id recipient_id=p.id %}"><img src="{{ STATIC_URL }}machiavelli/img/envelope.png" title="{% trans "Send message" %}" /></a>
	{% if game.configuration.finances %}
		<a href="{% url lend game.slug p.id %}"><img src="{{ STATIC_URL }}machiavelli/img/coin.png" title="{% trans "Give money" %}" /></a>
	{% endif %}
	</div>
	{% endifnotequal %}
	{% if can_excommunicate %}
		{% ifnotequal p.excommunicated 1 %}
		<div><a href="{% url excommunicate game.slug p.id %}">{% trans "Excommunicate" %}</a></div>
		{% endifnotequal %}
	{% endif %}
	{% endifnotequal %}
	{% endifnotequal %}
{% endif %}
	</div>
	{% endif %}
{% endfor %}
{% if can_excommunicate %}
	<a href="{% url reset-excommunications game.slug %}">{% trans "Forgive excommunications" %}</a>
{% endif %}

{% else %} {# show only the user names of the players #}
	{% if show_users %}
	<div>{% trans "Current players" %}</div>
	<ul>
		{% for p in player_list %}
			<li>{{ p.user.username }}</li>
		{% endfor %}
	</ul>
	{% endif %}
{% endif %}
</div>
</div>

<div class="col2">
	<div id="map" class="viewer">
	</div>
</div>

<div class="col3">

<div id="log">
<h3>{% trans "Campaign log" %}</h3>
<ul>
{% for l in log %}
{{ l.color_output|safe }}
{% endfor %}
</ul>
</div>
<div class="menu">
<p><a href="{% url game-log game.slug %}">{% trans "See all" %}</a> | 
<a href="{% url turn-log-list game.slug %}">{% trans "Process" %}</a></p>
</div>
</div>

<div class="clear"></div>

<div id="actions">
{% block actions %}{% endblock %}
</div>

{% endblock %}

{% block extra_game %}{% endblock %}

{% block extra_body %}
<script src="{{ STATIC_URL }}js/jquery.mousewheel.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/jquery.iviewer.min.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		makeLayout();
	});

	function makeLayout() {
		var MEDIA_URL = "{{ MEDIA_URL }}";
		var viewer_opts = {
			//src: MEDIA_URL + "maps/{{ map }}",
			src: "/media/maps/map-25.jpg",
			ui_disabled: true,
			zoom: "fit",
			zoom_max: 100,
			zoom_min: 10,
			zoom_delta: 1.4,
			//zoom_base:
			update_on_resize: true
		};

		$("#map").iviewer(viewer_opts);
	}
</script>


{% endblock %}
