{% extends "machiavelli/base.html" %}

{% load i18n %}
{% load game_icons %}

{% block head_title %}
{% if player %}
	{% if player.done %}
		[&bull;]
	{% else %}
		[ ]
	{% endif %}
{% endif %}
 {{ game.slug }}
{% endblock %}

{% block body %}
<div id="game_info">
<ul>
<li>{% trans "Game" %}: {{ game.slug }}</li>
<li>{% trans "Year" %}: {{ game.year|default_if_none:"" }}</li>
<li>{% trans "Season" %}: {{ game.get_season_display|default_if_none:"" }}</li>
<li>{% trans "Phase" %}: {{ game.get_phase_display }}</li>
<li>{% trans "Time left" %}: 
{% if player and game.slots == 0 %}
	{% if time_exceeded %}
	<span style="color: LightCoral">
	{{ game.next_phase_change|timeuntil }} 
	</span>
	{% else %}
	<span style="color: Green">
	{{ player.next_phase_change|timeuntil }}
	</span>
	{% endif %}
{% else %}
	{{ game.next_phase_change|timeuntil }}</li>
{% endif %}
</li>
{% if player %}
<li>{% trans "Power" %}:
	{% if player.country %}
		{{ player.country }}
	{% endif %}
</li>
{% else %}
<li>
		{% ifnotequal game.slots 0 %}
			<a href="{% url machiavelli.views.join_game game.pk %}">{% trans "Join game" %}</a>
		{% endifnotequal %}
</li>
{% endif %}
{% if rules %}
<li>
{% trans "Rules" %}: {% rule_icons game.configuration %}
</li>
{% endif %}
</ul>
</div>



<div class="col1">
<div id="powers">
{% if player.country %}
<div style="text-align: center">
<img src="{{ STATIC_URL }}machiavelli/img/banner-{{ player.country.css_class }}.png" />
</div>
{% endif %}
{% if game.slots == 0 %} {# show all the powers info #}
{% for p in player_list %}
	{% if p.user %}
	<div class="player {{ p.country.css_class }}">
	<div><strong>{{ p.country }}</strong>
	{% if p.conqueror %}
		({{ p.conqueror.country }})
	{% endif %}
	{% if p.excommunicated %}
	<img src="{{ STATIC_URL }}machiavelli/img/excommunication-icon-16.png" />
	{% endif %}
	</div>
	{% if show_users %}
	<div><a href="{% url profile_detail username=p.user.username %}">{{ p.user.username }}</a></div>
	{% endif %}
	<div>{% trans "Cities:" %} {{ p.number_of_cities }}</div>
	<div>{% trans "Units:" %} {{ p.number_of_units }}</div>
{% if player %}
	{% ifnotequal game.phase 0 %}
	{% ifnotequal p player %}
	{% ifnotequal p.eliminated 1 %}
	<div><a href="{% url new-letter sender_id=player.id receiver_id=p.id %}">{% trans "Send message" %}</a></div>
	{% endifnotequal %}
	{% if can_excommunicate %}
		{% ifnotequal p.excommunicated 1 %}
		<div><a href="{% url excommunicate game.slug p.id %}">{% trans "Excommunicate" %}</a></div>
		{% endifnotequal %}
	{% endif %}
	{% endifnotequal %}
	{% endifnotequal %}
{% endif %}
	</div>
	{% endif %}
{% endfor %}
{% if can_excommunicate %}
	<a href="{% url reset-excommunications game.slug %}">{% trans "Forgive excommunications" %}</a>
{% endif %}

{% else %} {# show only the user names of the players #}
	{% if show_users %}
	<div>{% trans "Current players" %}</div>
	<ul>
		{% for p in player_list %}
			<li>{{ p.user.username }}</li>
		{% endfor %}
	</ul>
	{% endif %}
{% endif %}
</div>
</div>

<div class="col2">
<div id="map">
{% blocktrans %}Our cartographers are drawing a new map for you. Please, reload
the page in a few seconds.{% endblocktrans %}
</div>
</div>

<div class="col3">
<div id="diplomacy">
<h3>{% trans "Diplomacy" %}</h3>
<table>
<thead><tr>
<th>{% trans "Box" %}</th>
<th>{% trans "All" %}</th>
<th>{% trans "Unread" %}</th>
</tr></thead>
<tr>
<td><a href="{% url inbox game.slug %}">{% trans "Inbox" %}</a></td>
<td class="data_c">{{ inbox_all }}</td>
<td class="data_c">
{% ifnotequal inbox_unread 0 %}
<span style="font-weight: bold; color: #ff0000">{{ inbox_unread }}</span>
{% endifnotequal %}
</td>
</tr>
<tr>
<td><a href="{% url outbox game.slug %}">{% trans "Outbox" %}</a></td>
<td class="data_c">{{ outbox_all }}</td>
<td class="data_c"></td>
</tr>
</table>
<ul>
{% for letter in inbox %}
<a href="{% url show-letter letter.id %}">{{ letter.inbox_color_output|safe }}</a>
{% endfor %}
</ul>
</div>

<div id="log">
<h3>{% trans "Campaign log" %}</h3>
<ul>
{% for l in log %}
{{ l.color_output|safe }}
{% endfor %}
</ul>
</div>
<div class="menu">
<p><a href="{% url game-log game.slug %}">{% trans "See all" %}</a> | 
<a href="{% url turn-log-list game.slug %}">{% trans "Process" %}</a></p>
</div>
</div>

<div class="clear"></div>

<div id="actions">
{% block actions %}{% endblock %}
</div>

{% endblock %}

{% block extra_body %}

{% block extra_game %}{% endblock %}

{% if map %}
	<script type="text/javascript">
		var STATIC_URL = "{{ STATIC_URL }}"
		var MEDIA_URL = "{{ MEDIA_URL }}"
	</script>
	<!-- Import the prototype library -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/prototype-1.5.0.js"></script>
	<!-- Import the base Experience namespace -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/experience.js"></script>
	<!-- Import Experience::Panorama files -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/experience.panorama.js"></script>
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}machiavelli/css/experience.panorama.css" />
	<!-- Initialize Panorama -->
	<script type="text/javascript">
	var	viewer;
	
	window.onload = function() {
		viewer = new experience.panorama.Viewer({
			ImageURL: MEDIA_URL + "maps/{{ map }}",
			ImageWidth: 1250,
			ImageHeight: 1780,
			RenderIn: 'map',
			IconDirectory: STATIC_URL + "machiavelli/js/icons",
			InnerUpperOffset: -300,
			ShowNavigator: false,
			ShowZoomSelectBox: true
		});
	}
	</script>
{% endif %}


{% endblock %}
