{% extends "machiavelli/base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Game:" %} {{ game.slug }}{% endblock %}

{% block body %}
<div id="game_info">
<ul>
<li>{% trans "Game" %}: {{ game.slug }}</li>
<li>{% trans "Year" %}: {{ game.year|default_if_none:"" }}</li>
<li>{% trans "Season" %}: {{ game.get_season_display|default_if_none:"" }}</li>
<li>{% trans "Phase" %}: {{ game.get_phase_display }}</li>
<li>{% trans "Time left" %}: {{ game.next_phase_change|timeuntil }}</li>
{% if player %}
<li>{% trans "Power" %}:
	{% if player.country %}
		{% trans player.country %}
	{% endif %}
</li>
{% else %}
<li>
		{% ifnotequal game.slots 0 %}
			<a href="{% url machiavelli.views.join_game game.pk %}">{% trans "Join game" %}</a>
		{% endifnotequal %}
</li>
{% endif %}
</ul>
</div>

<div class="col1">
<div id="powers">
{% if player.country %}
<div style="text-align: center">
<img src="{{ STATIC_URL }}machiavelli/img/banner-{{ player.country.css_class }}.png" />
</div>
{% endif %}
{% ifequal game.slots 0 %}
{% for p in game.player_set.all %}
	{% if p.user %}
	<div class="player {{ p.country.css_class }}">
	<div><strong>{% trans p.country %}</strong>
	{% ifequal p.done 1 %}
	<span><img src="{{ STATIC_URL }}machiavelli/img/icon-yes.gif" /></span>
	{% endifequal %}
	</div>
	<div>{% trans "Cities:" %} {{ p.number_of_cities }}</div>
	<div>{% trans "Units:" %} {{ p.number_of_units }}</div>
{% if player %}
	{% ifnotequal game.phase 0 %}
	{% ifnotequal p player %}
	<div><a href="{% url new-letter sender_id=player.id receiver_id=p.id %}">{% trans "Send message" %}</a></div>
	{% endifnotequal %}
	{% endifnotequal %}
{% endif %}
	</div>
	{% endif %}
{% endfor %}
{% endifequal %}
</div>
</div>

<div class="col2">
<div id="map">
{% blocktrans %}Our cartographers are drawing a new map for you. Please, reload
the page in a few seconds.{% endblocktrans %}
</div>
</div>

<div class="col3">
<div id="diplomacy">
<h3>{% trans "Diplomacy" %}</h3>
<table>
<thead><tr>
<th>{% trans "Box" %}</th>
<th>{% trans "All" %}</th>
<th>{% trans "Unread" %}</th>
</tr></thead>
<tr>
<td><a href="{% url inbox game.slug %}">{% trans "Inbox" %}</a></td>
<td class="data_c">{{ inbox_all }}</td>
<td class="data_c">
{% ifnotequal inbox_unread 0 %}
<span style="font-weight: bold; color: #ff0000">{{ inbox_unread }}</span>
{% endifnotequal %}
</td>
</tr>
<tr>
<td><a href="{% url outbox game.slug %}">{% trans "Outbox" %}</a></td>
<td class="data_c">{{ outbox_all }}</td>
<td class="data_c"></td>
</tr>
</table>
<ul>
{% for letter in inbox %}
<a href="{% url show-letter letter.id %}">{{ letter.inbox_color_output|safe }}</a>
{% endfor %}
</ul>
</div>

<div id="log">
<h3>{% trans "Campaign log" %}</h3>
<ul>
{% for l in log %}
{{ l.color_output|safe }}
{% endfor %}
</ul>
</div>
<div class="menu">
<p><a href="{% url game-log game.slug %}">{% trans "See all" %}</a> | 
<a href="{% url turn-log-list game.slug %}">{% trans "Process" %}</a></p>
</div>
</div>

<div class="clear"></div>

<div id="actions">
{% block actions %}{% endblock %}
</div>

{% endblock %}

{% block extra_body %}
{% if map %}
{% ifequal game.map_outdated 0 %}
	<script type="text/javascript">
		var STATIC_URL = "{{ STATIC_URL }}"
	</script>
	<!-- Import the prototype library -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/prototype-1.5.0.js"></script>
	<!-- Import the base Experience namespace -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/experience.js"></script>
	<!-- Import Experience::Panorama files -->
	<script type="text/javascript" src="{{ STATIC_URL }}machiavelli/js/experience.panorama.js"></script>
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}machiavelli/css/experience.panorama.css" />
	<!-- Initialize Panorama -->
	<script type="text/javascript">
	var	viewer;
	
	window.onload = function() {
		viewer = new experience.panorama.Viewer({
			ImageURL: STATIC_URL + "machiavelli/maps/{{ map }}",
			ImageWidth: 1250,
			ImageHeight: 1780,
			RenderIn: 'map',
			IconDirectory: STATIC_URL + "machiavelli/js/icons",
			InnerUpperOffset: -300,
			ShowNavigator: false,
			ShowZoomSelectBox: true
		});
	}
	</script>
{% endifequal %}
{% endif %}

{% endblock %}
